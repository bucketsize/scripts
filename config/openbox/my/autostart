#!/bin/sh

# opendesktop autostart
# TODO:
# 2. download and cycle through wallpapers
# 3. brightness control
# 4. complete shortcuts
# 9. fix compositing; compton is crashing in alpine

start(){
	log=/var/tmp/ob-`echo "$2" | sed 's/\//-/g'`.log
	(sleep $1 && $2 1>$log 2>$log ) &
}
stop(){
	if [ $2 == 'xautolock' ]; then
		(sleep $1 && xautolock -exit) &
	else
		(sleep $1 && killall $2) &
	fi
}

stopAll(){
	stop 1 picom
	stop 1 dunst
	stop 1 tint2
	stop 2 skhkd
	stop 2 lxpolkit
	stop 2 lxclipboard
	stop 3 xautolock
	stop 3 light-locker
	stop 3 conky
}
startAll(){
	start 1 ~/scripts/xdg/x.wallpaper.sh
	start 1 picom
	start 2 dunst
	start 3 tint2
	start 3 sxhkd
	start 4 lxpolkit
	start 4 lxclipboard
	start 5 xautolock \
	 -time 5 -locker "~/scripts/sys_ctl/ctl.lua cmd scr_lock" \
	 -killtime 10 -killer "notify-send -u critical -t 10000 -- 'Killing system ...'" \
	 -notify 30 -notifier "notify-send -u critical -t 10000 -- 'Locking system ETA 30s ...'"
	start 5 ~/scripts/sys_ctl/ctl.lua cmd scr_lock_on_lid
	start 5 ~/scripts/sys_ctl/ctl.lua cmd dtop_viga
	start 5 ~/scripts/sys_ctl/ctl.lua fun pa_set_default
	start 5 conky
}

case $i in
    stop)
        stopAll
        ;;
    *)
        stopAll
        startAll
        ;;
esac



